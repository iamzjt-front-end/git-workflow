# 发布脚本

## 使用方法

```bash
# 预览发布流程（推荐先执行）
npm run release:dry

# 实际发布
npm run release
```

## 优化特性

### ✅ 已实现的优化

1. **Dry-run 模式** - 预览发布流程，不实际执行
2. **自动回滚** - 出错时自动恢复 package.json、删除 tag、回退 commit
3. **多重确认** - 版本选择、CHANGELOG 预览、最终发布三次确认
4. **完整验证**
   - npm 登录状态检查
   - 版本号重复检查
   - 构建产物验证
   - 测试运行（如果有）
5. **CHANGELOG 预览** - 生成后显示最新内容并确认
6. **错误处理** - 完善的错误捕获和提示
7. **友好输出** - 带颜色的步骤提示和进度显示

## 前置条件

- 确保已登录 npm：`npm login`
- 确保有 GitHub 推送权限
- 确保在 main/master 分支（或确认在其他分支发布）
- 确保没有未提交的更改

## 发布流程

1. 检查必要命令（git, node, npm）
2. 检查 npm 登录状态
3. 检查 git 仓库状态
4. 拉取最新代码
5. 选择版本号
6. 检查版本是否已存在
7. 运行测试（如果有）
8. 构建项目
9. 验证构建产物
10. 生成 CHANGELOG
11. 预览并确认
12. 最终确认
13. 提交更改
14. 创建 tag
15. 推送到 GitHub
16. 发布到 npm

## 使用示例

详见主 README 的发布部分。
